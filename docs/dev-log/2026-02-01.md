ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª (ãƒ¡ã‚¤ãƒ³ãƒ­ã‚°)
ğŸ“… ä»Šæ—¥ã®é–‹ç™ºãƒ­ã‚° â€” Shiori Auth & System Integration
âœ… ä»Šæ—¥ã‚„ã£ãŸã“ã¨

Supabaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®å®Œå…¨æ¥ç¶š

supabase-js ã‚’ä½¿ã£ãŸèªè¨¼åŸºç›¤ã®æ§‹ç¯‰

Google OAuthãƒ­ã‚°ã‚¤ãƒ³å®Ÿè£…å®Œäº†

ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãƒ•ãƒ­ãƒ¼ç†è§£

getSession â†’ onAuthStateChange â†’ readyçŠ¶æ…‹

ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã«å¿œã˜ãŸUIåˆ†å²å‡¦ç†å®Ÿè£…

æœªãƒ­ã‚°ã‚¤ãƒ³ â†’ èª­ã¿å–ã‚Šå°‚ç”¨ãƒ¢ãƒ¼ãƒ‰

ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ â†’ ä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤å¯èƒ½

ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ãƒ˜ãƒƒãƒ€ãƒ¼ã«è¡¨ç¤º

ã‚¢ãƒã‚¿ãƒ¼

ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ 

ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒœã‚¿ãƒ³

RLSï¼ˆRow Level Securityï¼‰æ§‹é€ ç†è§£

DBã¨ãƒ•ãƒ­ãƒ³ãƒˆã®èªè¨¼é€£å‹•æˆåŠŸ

èªè¨¼ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ«ãƒ¼ãƒˆ /auth/callback å®Ÿè£…

ã‚»ãƒƒã‚·ãƒ§ãƒ³å¾©å…ƒã¨è‡ªå‹•ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†ç¢ºèª

ğŸ§  ä»Šæ—¥ç†è§£ã—ãŸã“ã¨

OAuthãƒ­ã‚°ã‚¤ãƒ³å•é¡Œã®å¤šãã¯ã‚³ãƒ¼ãƒ‰ã§ã¯ãªãã€Œã‚³ãƒ³ã‚½ãƒ¼ãƒ«è¨­å®šã€

èªè¨¼ã¯UIæ©Ÿèƒ½ã§ã¯ãªãã€Œã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã‚·ã‚¹ãƒ†ãƒ ã€

Supabaseã¯
Auth + DB + Policy + API ãŒä¸€ä½“åŒ–ã•ã‚ŒãŸæ§‹é€ 

RLSã¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ã„ã†ã‚ˆã‚Šã€Œãƒ‡ãƒ¼ã‚¿ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã€

ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®æµã‚Œã‚’å®Ÿä½“é¨“ã§ç†è§£

âš ï¸ ä»Šæ—¥ç™ºç”Ÿã—ãŸå•é¡Œ
å•é¡Œ	åŸå› 	è§£æ±º
Googleãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼	OAuthãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURIæœªè¨­å®š	Google Cloud Consoleè¨­å®šä¿®æ­£
401ã‚¨ãƒ©ãƒ¼	RLSã«ã‚ˆã‚‹æœªãƒ­ã‚°ã‚¤ãƒ³æŒ¿å…¥æ‹’å¦	ãƒ­ã‚°ã‚¤ãƒ³å¿…é ˆæ§‹é€ ã¸å¤‰æ›´
ãƒ­ã‚°ã‚¤ãƒ³å¾Œç”»é¢ãŒå¤‰ã‚ã‚‰ãªã„	ã‚»ãƒƒã‚·ãƒ§ãƒ³readyå¾…æ©Ÿå‡¦ç†ä¸è¶³	useSessionãƒ•ãƒ­ãƒ¼ä¿®æ­£
ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³å‹•ã‹ãªã„	callbackãƒ«ãƒ¼ãƒˆæœªå®Ÿè£…	/auth/callbackè¿½åŠ 
ğŸš€ ä»Šã®æ®µéš

Shioriã¯ã€Œèªè¨¼ä»˜ãå®Ÿé‹ç”¨æ§‹é€ ã€ã«åˆ°é”

ã“ã‚Œã¯ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ãƒ¬ãƒ™ãƒ«ã§ã¯ãªãå®Ÿå‹™ãƒ¬ãƒ™ãƒ«æ§‹é€ ã€‚

ğŸ‡ºğŸ‡¸ English
ğŸ“… Dev Log â€” Shiori Auth Integration Day
âœ… What was completed

Full Supabase â†” Frontend connection

Authentication system implemented with supabase-js

Google OAuth login fully working

Session lifecycle understood
getSession â†’ onAuthStateChange â†’ ready

UI split based on login state

Header user profile display (avatar, nickname, logout)

RLS system behavior understood

DB â†” Auth linkage verified

Auth callback route /auth/callback built

Session restore and auto-login confirmed

ğŸ§  Key Learnings

Most OAuth issues are console configuration, not code

Auth is not UI, it is an access control system

Supabase = Auth + DB + Policy + API ecosystem

RLS acts as a data access filter

Session management flow fully understood

âš ï¸ Issues Encountered
Issue	Cause	Fix
Google login invalid request	Missing redirect URI	Fixed in Google Console
401 errors	RLS blocking inserts	Login-required structure
UI not updating after login	Session ready timing	Fixed useSession logic
Login button no action	Missing callback route	Added /auth/callback
ğŸš€ Current Level

Project upgraded from tutorial app â†’ production-style auth architecture.

ğŸ‡°ğŸ‡· í•œêµ­ì–´
ğŸ“… ì˜¤ëŠ˜ ê°œë°œ ë¡œê·¸ â€” Shiori ì¸ì¦ ì‹œìŠ¤í…œ êµ¬ì¶•
âœ… ì˜¤ëŠ˜ ì™„ë£Œí•œ ì‘ì—…

Supabaseì™€ í”„ë¡ íŠ¸ ì™„ì „ ì—°ê²°

supabase-js ê¸°ë°˜ ì¸ì¦ ì‹œìŠ¤í…œ êµ¬ì¶•

Google ë¡œê·¸ì¸ êµ¬í˜„ ì™„ë£Œ

ì„¸ì…˜ íë¦„ ì´í•´
getSession â†’ onAuthStateChange â†’ ready

ë¡œê·¸ì¸ ìƒíƒœ ê¸°ë°˜ UI ë¶„ê¸° êµ¬í˜„

í—¤ë”ì— ì‚¬ìš©ì ì •ë³´ í‘œì‹œ (ì•„ë°”íƒ€, ë‹‰ë„¤ì„, ë¡œê·¸ì•„ì›ƒ)

RLS ë™ì‘ êµ¬ì¡° ì´í•´

DBì™€ ì¸ì¦ ì—°ë™ í™•ì¸

/auth/callback ë¼ìš°íŠ¸ êµ¬í˜„

ìë™ ì„¸ì…˜ ë³µì› í™•ì¸

ğŸ§  ì˜¤ëŠ˜ ì–»ì€ í•µì‹¬ ì´í•´

OAuth ë¬¸ì œ ëŒ€ë¶€ë¶„ì€ ì½”ë“œê°€ ì•„ë‹ˆë¼ ì½˜ì†” ì„¤ì •

ë¡œê·¸ì¸ ê¸°ëŠ¥ì€ UIê°€ ì•„ë‹ˆë¼ ê¶Œí•œ ì‹œìŠ¤í…œ

SupabaseëŠ” Auth+DB+Policy+API í†µí•© êµ¬ì¡°

RLSëŠ” ë³´ì•ˆê¸°ëŠ¥ì´ë¼ê¸°ë³´ë‹¤ ë°ì´í„° ì ‘ê·¼ í•„í„°

ì„¸ì…˜ ê´€ë¦¬ íë¦„ì„ ì§ì ‘ ì²´í—˜í•˜ë©° ì´í•´

âš ï¸ ê²ªì€ ë¬¸ì œë“¤
ë¬¸ì œ	ì›ì¸	í•´ê²°
êµ¬ê¸€ ë¡œê·¸ì¸ ì˜¤ë¥˜	ë¦¬ë””ë ‰íŠ¸ URI ëˆ„ë½	ì½˜ì†” ì„¤ì • ìˆ˜ì •
401 ì˜¤ë¥˜	RLSê°€ insert ì°¨ë‹¨	ë¡œê·¸ì¸ í•„ìˆ˜ êµ¬ì¡°ë¡œ ë³€ê²½
ë¡œê·¸ì¸ í›„ í™”ë©´ ë³€í™” ì—†ìŒ	ready ì²˜ë¦¬ ë¶€ì¡±	useSession ë¡œì§ ìˆ˜ì •
ë¡œê·¸ì¸ ë²„íŠ¼ ë¬´ë°˜ì‘	callback ë¼ìš°íŠ¸ ì—†ìŒ	/auth/callback êµ¬í˜„
ğŸš€ í˜„ì¬ ë‹¨ê³„

Shioriê°€ â€œì‹¤ì„œë¹„ìŠ¤ ì¸ì¦ êµ¬ì¡°â€ ë‹¨ê³„ì— ë„ë‹¬

ğŸ’¬ ì´ê±´ ì§„ì§œë¡œ
â€œê°œë°œì ë ˆë²¨ í•œ ë‹¨ê³„ ìƒìŠ¹í•œ ë‚ â€ ê¸°ë¡ì´ë‹¤.